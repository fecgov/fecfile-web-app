@if (showLookup()) {
  <div class="grid">
    <div class="col-12">
      <div class="field">
        <label for="entity_type">LOOKUP</label>
        <app-transaction-contact-lookup
          id="contact_1_lookup"
          contactProperty="contact_1"
          [transaction]="transaction()"
          [form]="form()"
          [formSubmitted]="formSubmitted()"
          [contactTypeOptions]="contactTypeOptions()"
          [(contactType)]="contactType"
          [(contact)]="primaryContact"
        >
        </app-transaction-contact-lookup>
      </div>
    </div>
  </div>
}

@if (transaction().contact_1) {
  @if (isOrganization() || isCommittee()) {
    <app-committee-input
      [form]="form()"
      [formSubmitted]="formSubmitted()"
      [templateMap]="templateMap()"
      [entityRole]="isOrganization() ? 'ORGANIZATION' : 'COMMITTEE'"
      [includeFecId]="hasCommitteeFecId()"
    ></app-committee-input>
  } @else if (isIndividual()) {
    <app-name-input [form]="form()" [formSubmitted]="formSubmitted()" [templateMap]="templateMap()"></app-name-input>
  }

  <hr class="solid" />
  <app-section-header [isSingle]="isSingle()" text="Address"></app-section-header>
  <app-address-input
    [form]="form()"
    [formSubmitted]="formSubmitted()"
    [templateMap]="templateMap()"
  ></app-address-input>
  @if (transactionType().hasEmployeeFields() && isIndividual()) {
    <hr class="solid" />
    <app-section-header [isSingle]="isSingle()" text="Employer"></app-section-header>
    <app-employer-input
      [form]="form()"
      [formSubmitted]="formSubmitted()"
      [templateMap]="templateMap()"
    ></app-employer-input>
  }
  @if (isHigh()) {
    <ng-container *ngTemplateOutlet="candidateInfo"></ng-container>
  }
  @if (transactionType().hasAmountInput) {
    <hr class="solid" />
    <app-section-header [isSingle]="isSingle()" [text]="transactionType().amountInputHeader"></app-section-header>
    <app-amount-input
      [form]="form()"
      [formSubmitted]="formSubmitted()"
      [templateMap]="templateMap()"
      [contributionAmountReadOnly]="contributionAmountReadOnly()"
      [negativeAmountValueOnly]="!!transactionType().negativeAmountValueOnly"
      [showAggregate]="!!transactionType().showAggregate"
      [showCalendarYTD]="!!transactionType().showCalendarYTD"
      [transaction]="transaction()"
      [memoCodeCheckboxLabel]="(memoCodeCheckboxLabel$() | async)!"
    ></app-amount-input>
  }
  @if (transactionType().hasDebtInput) {
    <hr class="solid" />
    <app-section-header [isSingle]="isSingle()" [text]="transactionType().debtInputHeader"></app-section-header>
    <app-debt-input
      [form]="form()"
      [formSubmitted]="formSubmitted()"
      [templateMap]="templateMap()"
      [transaction]="transaction()"
    ></app-debt-input>
  }
  @if (transactionType().hasLoanFinanceFields()) {
    <hr class="solid" />
    <app-section-header [isSingle]="isSingle()" [text]="transactionType().amountInputHeader"></app-section-header>
    <app-loan-info-input
      [form]="form()"
      [formSubmitted]="formSubmitted()"
      [templateMap]="templateMap()"
      [readonly]="false"
      [transaction]="transaction()"
    ></app-loan-info-input>
  }
  @if (transactionType().hasLoanTermsFields() && !transactionType().hasLoanAgreement) {
    <hr class="solid" />
    <app-section-header [isSingle]="isSingle()" text="Terms"></app-section-header>
    <app-loan-terms-input
      [form]="form()"
      [formSubmitted]="formSubmitted()"
      [templateMap]="templateMap()"
      [transaction]="transaction()"
    ></app-loan-terms-input>
  }
  @if (transactionType().hasLoanAgreement) {
    <hr class="solid" />
    <app-section-header [isSingle]="isSingle()" text="Loan information"></app-section-header>
    <app-loan-agreement-input
      [form]="form()"
      [formSubmitted]="formSubmitted()"
      [templateMap]="templateMap()"
      [transaction]="transaction()"
      [(contact)]="secondaryContact"
    ></app-loan-agreement-input>
  }
  @if (isLow()) {
    <ng-container *ngTemplateOutlet="candidateInfo"></ng-container>
  }
  @if (transactionType().hasAdditionalInfo) {
    <hr class="solid" />
    <app-section-header [isSingle]="isSingle()" text="Additional information"></app-section-header>
    <app-additional-info-input
      [form]="form()"
      [formSubmitted]="formSubmitted()"
      [templateMap]="templateMap()"
      [transaction]="transaction()"
      [(designatingCommittee)]="designatingCommittee"
      [(subordinateCommitee)]="subordinateCommitee"
    ></app-additional-info-input>
  }
  @if (hasSignature1()) {
    <hr class="solid" />
    <app-section-header [isSingle]="isSingle()" [text]="transactionType().signatoryOneHeader"></app-section-header>
    <app-signature-input
      [form]="form()"
      [formSubmitted]="formSubmitted()"
      [templateMap]="templateMap()"
      class="signatory_1_input"
      templateMapKeyPrefix="signatory_1"
    ></app-signature-input>
  }
  @if (hasSignature2()) {
    <hr class="solid" />
    <app-section-header [isSingle]="isSingle()" [text]="transactionType().signatoryTwoHeader"></app-section-header>
    <app-signature-input
      [form]="form()"
      [formSubmitted]="formSubmitted()"
      [templateMap]="templateMap()"
      class="signatory_2_input"
      templateMapKeyPrefix="signatory_2"
    ></app-signature-input>
  }
  @if (footer()) {
    <hr class="solid" />
    <div class="grid">
      <span class="transaction-type-footer">
        <b>{{ footer() }}</b>
      </span>
    </div>
  }
}

<ng-template #candidateInfo>
  @if (hasCandidateInfo() || contact3Required()) {
    <hr class="solid" />
    <app-section-header
      [isSingle]="isSingle()"
      [text]="transactionType().committeeCandidateHeader"
    ></app-section-header>
    @if (contact3Required()) {
      <div class="candidate_committee_lookup">
        <label for="contact_3">LOOKUP </label>
        <app-transaction-contact-lookup
          id="contact_3_lookup"
          contactProperty="contact_3"
          [transaction]="transaction()"
          [form]="form()"
          [formSubmitted]="formSubmitted()"
          [contactTypeOptions]="committeeContactTypeOptions"
          [(contact)]="tertiaryContact"
        ></app-transaction-contact-lookup>
        @if (transaction().contact_3) {
          <app-committee-input
            [form]="form()"
            [formSubmitted]="formSubmitted()"
            [templateMap]="templateMap()"
            entityRole="COMMITTEE"
            [includeFecId]="true"
            [readonly]="false"
            [transaction]="transaction()"
            [tertiaryContact]="true"
          ></app-committee-input>
        }
      </div>
    } @else if (transactionType().hasCandidateCommittee) {
      <app-committee-input
        [form]="form()"
        [formSubmitted]="formSubmitted()"
        [templateMap]="templateMap()"
        entityRole="COMMITTEE"
        [includeFecId]="true"
        [readonly]="true"
        [transaction]="transaction()"
      ></app-committee-input>
    }
    @if (hasSupportOppose()) {
      <app-support-oppose-input [form]="form()" [formSubmitted]="formSubmitted()"></app-support-oppose-input>
    }

    @if (hasCandidateInfo()) {
      @if (!transactionType().hideContactLookup) {
        <div class="candidate_committee_lookup">
          <label for="contact_2"
            >LOOKUP
            @if (!transactionType().contact2IsRequired(form())) {
              (OPTIONAL)
            }
          </label>
          <app-transaction-contact-lookup
            id="contact_2_lookup"
            contactProperty="contact_2"
            [transaction]="transaction()"
            [form]="form()"
            [formSubmitted]="formSubmitted()"
            [contactTypeOptions]="candidateContactTypeOptions"
            [(contact)]="candidateContact"
          ></app-transaction-contact-lookup>
        </div>
      }
      @if (transaction().contact_2) {
        <div class="candidate_committee_lookup">
          <app-candidate-input
            [transaction]="transaction()"
            [form]="form()"
            [formSubmitted]="formSubmitted()"
            [templateMap]="templateMap()"
            [hasCandidateOfficeInput]="hasCandidateOffice()"
          ></app-candidate-input>
        </div>
      }
    }
  }
  @if (hasElectionInfo()) {
    <hr class="solid" />
    <app-section-header [isSingle]="isSingle()" text="Election information"></app-section-header>
    <app-election-input
      [transaction]="transaction()"
      [form]="form()"
      [formSubmitted]="formSubmitted()"
      [templateMap]="templateMap()"
    ></app-election-input>
  }
</ng-template>
