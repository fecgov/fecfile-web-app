<p-toast></p-toast>

<div class="p-fluid">
  <h1>{{ transaction?.transactionType?.alternateTitle || transaction?.transactionType?.title }}</h1>
  <h4 class="read-only-tag subtitle" *ngIf="!isEditable">READ ONLY</h4>
  <h3>Contact</h3>
  <form id="form" [formGroup]="form" [ngClass]="{ 'ng-submitted': formSubmitted }">
    <div class="grid" *ngIf="isEditable">
      <div class="col-12">
        <div class="field">
          <label for="entity_type">CONTACT TYPE</label>
          <app-transaction-contact-lookup
            [form]="form"
            [formSubmitted]="formSubmitted"
            [contactTypeOptions]="contactTypeOptions"
            [contactTypeFormControl]="$any(form).controls['entity_type']"
            selectedContactFormControlName="contact_1"
            [contactTypeReadOnly]="contactTypeOptions.length === 1"
            (contactSelect)="onContactLookupSelect($event)"
          >
          </app-transaction-contact-lookup>
        </div>
      </div>
    </div>
    <ng-container *ngIf="transaction?.contact_1">
      <ng-container
        *ngIf="[ContactTypes.ORGANIZATION, ContactTypes.COMMITTEE].includes(form.get('entity_type')?.value)"
      >
        <app-committee-input
          [form]="form"
          [formSubmitted]="formSubmitted"
          [templateMap]="templateMap"
          [entityRole]="getEntityType() === ContactTypes.ORGANIZATION ? 'ORGANIZATION' : 'COMMITTEE'"
          [includeFecId]="hasCommitteeFecIdInput"
        ></app-committee-input>
      </ng-container>
      <ng-container *ngIf="getEntityType() === ContactTypes.INDIVIDUAL">
        <app-name-input [form]="form" [formSubmitted]="formSubmitted" [templateMap]="templateMap"></app-name-input>
      </ng-container>
      <p-divider></p-divider>
      <h3>Address</h3>
      <app-address-input [form]="form" [formSubmitted]="formSubmitted" [templateMap]="templateMap"></app-address-input>
      <p-divider></p-divider>
      <ng-container *ngIf="hasEmployerInput">
        <h3>Employer</h3>
        <app-employer-input
          [form]="form"
          [formSubmitted]="formSubmitted"
          [templateMap]="templateMap"
        ></app-employer-input>
        <p-divider></p-divider>
      </ng-container>
      <h3>{{ templateMap.amountInputHeader }}</h3>
      <app-amount-input
        [form]="form"
        [formSubmitted]="formSubmitted"
        [templateMap]="templateMap"
        [memoCodeReadOnly]="isMemoCodeReadOnly(transaction?.transactionType)"
        [negativeAmountValueOnly]="!!transaction?.transactionType?.negativeAmountValueOnly"
        [showAggregate]="!!transaction?.transactionType?.showAggregate"
        [transaction]="transaction"
      ></app-amount-input>
      <ng-container *ngIf="transaction?.transactionType?.hasLoanInfoInput">
        <h3>Loan information</h3>
        <app-loan-info-input
          [form]="form"
          [formSubmitted]="formSubmitted"
          [templateMap]="templateMap"
          [readonly]="false"
          [memoCodeReadOnly]="isMemoCodeReadOnly(transaction?.transactionType)"
          [transaction]="transaction"
        ></app-loan-info-input>
        <p-divider></p-divider>
      </ng-container>
      <ng-container *ngIf="transaction?.transactionType?.hasLoanTermsInput">
        <h3>Terms</h3>
        <app-loan-terms-input
          [form]="form"
          [formSubmitted]="formSubmitted"
          [templateMap]="templateMap"
        ></app-loan-terms-input>
        <p-divider></p-divider>
      </ng-container>
      <p-divider></p-divider>
      <ng-container
        *ngIf="
          this.hasCandidateInformationInput ||
          !!transaction?.transactionType?.hasCandidateLookup ||
          this.hasCandidateCommitteeInput
        "
      >
        <h3>{{ templateMap['candidateInputHeader'] }}</h3>
      </ng-container>
      <ng-container *ngIf="this.hasCandidateCommitteeInput">
        <app-transaction-contact-lookup
          *ngIf="this.form.get('entity_type')?.value !== ContactTypes.COMMITTEE"
          [contactTypeFormControl]="committeeContactTypeFormControl"
          [contactTypeOptions]="committeeContactTypeOption"
          [contactTypeReadOnly]="true"
          (contactSelect)="onTertiaryContactLookupSelect($event)"
        ></app-transaction-contact-lookup>
        <app-committee-input
          *ngIf="this.transaction?.contact_3 || this.form.get('entity_type')?.value === ContactTypes.COMMITTEE"
          [form]="form"
          [formSubmitted]="formSubmitted"
          [templateMap]="templateMap"
          entityRole="COMMITTEE"
          [nameField]="
            this.form.get('entity_type')?.value !== ContactTypes.COMMITTEE ? 'committee_name' : 'organization_name'
          "
          [includeFecId]="true"
          [readonly]="this.form.get('entity_type')?.value === ContactTypes.COMMITTEE"
        ></app-committee-input>
      </ng-container>
      <ng-container *ngIf="this.hasCandidateInformationInput || !!transaction?.transactionType?.hasCandidateLookup">
        <app-transaction-contact-lookup
          [form]="form"
          [formSubmitted]="formSubmitted"
          [contactTypeOptions]="candidateContactTypeOption"
          [contactTypeFormControl]="candidateContactTypeFormControl"
          selectedContactFormControlName="contact_2"
          [contactTypeReadOnly]="true"
          (contactSelect)="onSecondaryContactLookupSelect($event)"
        ></app-transaction-contact-lookup>
        <ng-container *ngIf="transaction?.contact_2">
          <app-candidate-input
            [form]="form"
            [formSubmitted]="formSubmitted"
            [templateMap]="templateMap"
            [hasCandidateOfficeInput]="hasCandidateOfficeInput"
          ></app-candidate-input>
        </ng-container>
        <p-divider></p-divider>
      </ng-container>
      <ng-container *ngIf="hasElectionInformationInput">
        <h3>Election Information</h3>
        <app-election-input
          [form]="form"
          [formSubmitted]="formSubmitted"
          [templateMap]="templateMap"
        ></app-election-input>
        <p-divider></p-divider>
      </ng-container>
      <h3>Additional Information</h3>
      <app-additional-info-input
        [form]="form"
        [formSubmitted]="formSubmitted"
        [templateMap]="templateMap"
        [descriptionIsSystemGenerated]="isDescriptionSystemGenerated(transaction?.transactionType)"
        [purposeDescriptionLabel]="purposeDescriptionLabel"
        [purposeDescriptionLabelNotice]="transaction?.transactionType?.purposeDescriptionLabelNotice"
        [purposeDescriptionPrefix]="transaction?.transactionType?.purposeDescriptionPrefix"
      ></app-additional-info-input>
      <div class="grid" *ngIf="isEditable">
        <ng-template ngFor let-navigationControl [ngForOf]="getInlineControls()">
          <div class="col-4">
            <app-navigation-control
              [navigationControl]="navigationControl"
              [transaction]="transaction"
              (navigate)="handleNavigate($event)"
            ></app-navigation-control>
          </div>
        </ng-template>
      </div>
    </ng-container>
  </form>
</div>

<p-divider></p-divider>
<div class="p-fluid">
  <app-navigation-control-bar
    [navigationControls]="getNavigationControls()"
    [transaction]="transaction"
    (navigate)="handleNavigate($event)"
    [class]="isEditable ? '' : 'flex-center'"
  ></app-navigation-control-bar>
</div>

<p-confirmDialog key="dialog" [style]="{ width: '450px' }"></p-confirmDialog>
